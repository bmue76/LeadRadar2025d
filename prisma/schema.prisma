datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

// Ein Account entspricht einem Kunden/Mandanten.
// Darunter hängen Benutzer, Events, Formulare und Leads.
model Account {
  id        String   @id @default(cuid())
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  users  User[]
  events Event[]
  forms  Form[]
  leads  Lead[]
}

// Benutzer innerhalb eines Accounts.
model User {
  id        String    @id @default(cuid())
  email     String    @unique
  name      String?
  role      UserRole  @default(USER)
  accountId String
  account   Account   @relation(fields: [accountId], references: [id])
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  // Leads, die dieser User auf der Messe erfasst hat
  createdLeads Lead[] @relation("UserLeads")
}

enum UserRole {
  OWNER   // Konto-Inhaber
  ADMIN   // Kann alles im Account verwalten
  USER    // Messe-User, erfasst Leads
  VIEWER  // Lesen, aber nicht bearbeiten
}

// Eine Messe / Veranstaltung.
model Event {
  id        String   @id @default(cuid())
  accountId String
  account   Account  @relation(fields: [accountId], references: [id])

  name      String
  location  String?
  startDate DateTime?
  endDate   DateTime?
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  forms Form[]
  leads Lead[]
}

// Ein Formular für die Leaderfassung (z. B. pro Event).
model Form {
  id        String   @id @default(cuid())
  accountId String
  account   Account  @relation(fields: [accountId], references: [id])

  eventId String?
  event   Event? @relation(fields: [eventId], references: [id])

  name        String
  description String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  fields FormField[]
  leads  Lead[]
}

// Ein Feld innerhalb eines Formulars.
model FormField {
  id       String     @id @default(cuid())
  formId   String
  form     Form       @relation(fields: [formId], references: [id])

  type        FieldType
  label       String
  placeholder String?
  required    Boolean   @default(false)
  order       Int       // Reihenfolge im Formular
  options     String?   // z.B. JSON für Select-Optionen

  answers LeadAnswer[]
}

enum FieldType {
  TEXT
  TEXTAREA
  NUMBER
  SELECT
  MULTISELECT
  CHECKBOX
  RADIO
  EMAIL
  PHONE
  DATE
  TIME
}

// Ein erfasster Lead (Kontakt).
model Lead {
  id        String   @id @default(cuid())
  accountId String
  account   Account  @relation(fields: [accountId], references: [id])

  eventId String?
  event   Event? @relation(fields: [eventId], references: [id])

  formId String
  form   Form   @relation(fields: [formId], references: [id])

  createdByUserId String?
  createdByUser   User?   @relation("UserLeads", fields: [createdByUserId], references: [id])

  status    LeadStatus @default(NEW)
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt

  answers LeadAnswer[]
}

enum LeadStatus {
  NEW
  OPEN
  QUALIFIED
  WON
  LOST
  ARCHIVED
}

// Antwort auf ein einzelnes Formularfeld für einen Lead.
model LeadAnswer {
  id          String    @id @default(cuid())
  leadId      String
  lead        Lead      @relation(fields: [leadId], references: [id])

  formFieldId String
  formField   FormField @relation(fields: [formFieldId], references: [id])

  value String // Rohwert als Text; Interpretation macht später die App
}